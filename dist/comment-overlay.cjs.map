{"version":3,"file":"comment-overlay.cjs","sources":["../src/shared/logger.ts","../src/core/comment.ts","../src/config/default-settings.ts","../src/core/comment-renderer.ts"],"sourcesContent":["export type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\";\n\nexport interface Logger {\n  debug: (...messages: unknown[]) => void;\n  info: (...messages: unknown[]) => void;\n  warn: (...messages: unknown[]) => void;\n  error: (...messages: unknown[]) => void;\n}\n\nexport interface LoggerOptions {\n  level?: LogLevel;\n  emitter?: (level: LogLevel, namespace: string, args: unknown[]) => void;\n}\n\nconst LEVEL_PRIORITY: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\nconst fallbackEmitter = (level: LogLevel, namespace: string, args: unknown[]): void => {\n  const prefix = `[${namespace}]`;\n  const consoleArgs: unknown[] = [prefix, ...args];\n  switch (level) {\n    case \"debug\":\n      console.debug(...consoleArgs);\n      break;\n    case \"info\":\n      console.info(...consoleArgs);\n      break;\n    case \"warn\":\n      console.warn(...consoleArgs);\n      break;\n    case \"error\":\n      console.error(...consoleArgs);\n      break;\n    default:\n      console.log(...consoleArgs);\n  }\n};\n\nexport const createLogger = (namespace: string, options: LoggerOptions = {}): Logger => {\n  const { level = \"info\", emitter = fallbackEmitter } = options;\n  const threshold = LEVEL_PRIORITY[level];\n\n  const emit = (logLevel: LogLevel, args: unknown[]): void => {\n    if (LEVEL_PRIORITY[logLevel] < threshold) {\n      return;\n    }\n    emitter(logLevel, namespace, args);\n  };\n\n  return {\n    debug: (...messages: unknown[]) => emit(\"debug\", messages),\n    info: (...messages: unknown[]) => emit(\"info\", messages),\n    warn: (...messages: unknown[]) => emit(\"warn\", messages),\n    error: (...messages: unknown[]) => emit(\"error\", messages),\n  };\n};\n","import type { RendererSettings } from \"../shared/types\";\nimport { createLogger } from \"../shared/logger\";\n\nconst logger = createLogger(\"CommentEngine:Comment\");\n\nexport interface TimeSource {\n  now(): number;\n}\n\nconst createPerformanceTimeSource = (): TimeSource => ({\n  now: () => {\n    if (typeof performance !== \"undefined\" && typeof performance.now === \"function\") {\n      return performance.now();\n    }\n    return Date.now();\n  },\n});\n\nexport const createDefaultTimeSource = (): TimeSource => createPerformanceTimeSource();\n\nexport interface CommentDependencies {\n  timeSource?: TimeSource;\n}\n\nexport interface CommentPrepareOptions {\n  visibleWidth: number;\n  virtualExtension: number;\n  maxVisibleDurationMs: number;\n  minVisibleDurationMs: number;\n  maxWidthRatio: number;\n  bufferRatio: number;\n  baseBufferPx: number;\n  entryBufferPx: number;\n}\n\nexport class Comment {\n  readonly text: string;\n  readonly vpos: number;\n  readonly commands: string[];\n\n  x = 0;\n  y = 0;\n  width = 0;\n  height = 0;\n  baseSpeed = 0;\n  speed = 0;\n  lane = -1;\n  color: string;\n  fontSize = 0;\n  fontFamily = \"Arial\";\n  opacity: number;\n  isActive = false;\n  hasShown = false;\n  isPaused = false;\n  lastUpdateTime = 0;\n  reservationWidth = 0;\n  bufferWidth = 0;\n  visibleDurationMs = 0;\n  totalDurationMs = 0;\n  preCollisionDurationMs = 0;\n  speedPixelsPerMs = 0;\n  virtualStartX = 0;\n  private readonly timeSource: TimeSource;\n\n  constructor(\n    text: string,\n    vpos: number,\n    commands: string[] | undefined,\n    settings: RendererSettings,\n    dependencies: CommentDependencies = {},\n  ) {\n    if (typeof text !== \"string\") {\n      throw new Error(\"Comment text must be a string\");\n    }\n    if (!Number.isFinite(vpos) || vpos < 0) {\n      throw new Error(\"Comment vpos must be a non-negative number\");\n    }\n\n    this.text = text;\n    this.vpos = vpos;\n    this.commands = Array.isArray(commands) ? [...commands] : [];\n    this.color = settings.commentColor;\n    this.opacity = settings.commentOpacity;\n    this.timeSource = dependencies.timeSource ?? createDefaultTimeSource();\n  }\n\n  prepare(\n    ctx: CanvasRenderingContext2D,\n    visibleWidth: number,\n    canvasHeight: number,\n    options: CommentPrepareOptions,\n  ): void {\n    try {\n      if (!ctx) {\n        throw new Error(\"Canvas context is required\");\n      }\n      if (!Number.isFinite(visibleWidth) || !Number.isFinite(canvasHeight)) {\n        throw new Error(\"Canvas dimensions must be numbers\");\n      }\n      if (!options) {\n        throw new Error(\"Prepare options are required\");\n      }\n\n      const safeVisibleWidth = Math.max(visibleWidth, 1);\n      this.fontSize = Math.max(24, Math.floor(canvasHeight * 0.05));\n      ctx.font = `${this.fontSize}px ${this.fontFamily}`;\n      this.width = ctx.measureText(this.text).width;\n      this.height = this.fontSize;\n\n      const maxReservationWidth = ctx.measureText(\"??\".repeat(150)).width;\n\n      const bufferFromWidth = this.width * Math.max(options.bufferRatio, 0);\n      this.bufferWidth = Math.max(options.baseBufferPx, bufferFromWidth);\n      const entryBuffer = Math.max(options.entryBufferPx, this.bufferWidth);\n\n      this.virtualStartX = safeVisibleWidth + options.virtualExtension;\n      this.x = this.virtualStartX;\n\n      const widthRatio = this.width / safeVisibleWidth;\n      let visibleDurationMs = options.maxVisibleDurationMs;\n      if (widthRatio > 1) {\n        const clampedRatio = Math.min(widthRatio, options.maxWidthRatio);\n        const adjustedDuration = options.maxVisibleDurationMs / Math.max(clampedRatio, 1);\n        visibleDurationMs = Math.max(options.minVisibleDurationMs, Math.floor(adjustedDuration));\n      }\n\n      const visibleDistance = safeVisibleWidth + this.width + this.bufferWidth + entryBuffer;\n      const safeVisibleDuration = Math.max(visibleDurationMs, 1);\n      const pixelsPerMs = visibleDistance / safeVisibleDuration;\n      const pixelsPerFrame = (pixelsPerMs * 1000) / 60;\n      this.baseSpeed = pixelsPerFrame;\n      this.speed = this.baseSpeed;\n      this.speedPixelsPerMs = pixelsPerMs;\n\n      const travelDistance = this.virtualStartX + this.width + this.bufferWidth + entryBuffer;\n      const preCollisionBoundary = safeVisibleWidth + entryBuffer;\n      const startRight = this.virtualStartX + this.width + this.bufferWidth;\n      const safePixelsPerMs = Math.max(pixelsPerMs, Number.EPSILON);\n      const preCollisionDistance = Math.max(0, startRight - preCollisionBoundary);\n\n      this.visibleDurationMs = visibleDurationMs;\n      this.preCollisionDurationMs = Math.max(0, Math.ceil(preCollisionDistance / safePixelsPerMs));\n      this.totalDurationMs = Math.max(\n        this.preCollisionDurationMs,\n        Math.ceil(travelDistance / safePixelsPerMs),\n      );\n\n      const reservationBase = this.width + this.bufferWidth + entryBuffer;\n      this.reservationWidth = Math.min(maxReservationWidth, reservationBase);\n      this.lastUpdateTime = this.timeSource.now();\n      this.isPaused = false;\n    } catch (error) {\n      logger.error(\"Comment.prepare\", error as Error, {\n        text: this.text,\n        visibleWidth,\n        canvasHeight,\n        hasContext: Boolean(ctx),\n      });\n      throw error;\n    }\n  }\n\n  update(playbackRate = 1.0, isPaused = false): void {\n    try {\n      if (!this.isActive) {\n        this.isPaused = isPaused;\n        return;\n      }\n\n      const currentTime = this.timeSource.now();\n      if (isPaused) {\n        this.isPaused = true;\n        this.lastUpdateTime = currentTime;\n        return;\n      }\n\n      const deltaTime = (currentTime - this.lastUpdateTime) / (1000 / 60);\n      this.speed = this.baseSpeed * playbackRate;\n      this.x -= this.speed * deltaTime;\n      if (this.x < -this.width) {\n        this.isActive = false;\n      }\n      this.lastUpdateTime = currentTime;\n      this.isPaused = false;\n    } catch (error) {\n      logger.error(\"Comment.update\", error as Error, {\n        text: this.text,\n        playbackRate,\n        isPaused,\n        isActive: this.isActive,\n      });\n    }\n  }\n\n  draw(ctx: CanvasRenderingContext2D, interpolatedX: number | null = null): void {\n    try {\n      if (!this.isActive || !ctx) {\n        return;\n      }\n\n      ctx.save();\n      ctx.globalAlpha = this.opacity;\n      ctx.font = `${this.fontSize}px ${this.fontFamily}`;\n\n      const drawX = interpolatedX ?? this.x;\n      const drawY = this.y + this.fontSize;\n\n      ctx.strokeStyle = \"#000000\";\n      ctx.lineWidth = Math.max(3, this.fontSize / 8);\n      ctx.lineJoin = \"round\";\n      ctx.strokeText(this.text, drawX, drawY);\n\n      const baseShadowOffset = Math.max(1, this.fontSize * 0.04);\n      const baseShadowBlur = this.fontSize * 0.18;\n      const shadowLayers: ReadonlyArray<{\n        readonly offsetMultiplier: number;\n        readonly blurMultiplier: number;\n        readonly alpha: number;\n      }> = [\n        { offsetMultiplier: 1, blurMultiplier: 0.6, alpha: 0.45 },\n        { offsetMultiplier: 2, blurMultiplier: 1, alpha: 0.3 },\n        { offsetMultiplier: 3.2, blurMultiplier: 1.6, alpha: 0.18 },\n      ];\n\n      shadowLayers.forEach((layer) => {\n        const offset = baseShadowOffset * layer.offsetMultiplier;\n        ctx.shadowColor = `rgba(0, 0, 0, ${layer.alpha})`;\n        ctx.shadowBlur = baseShadowBlur * layer.blurMultiplier;\n        ctx.shadowOffsetX = offset;\n        ctx.shadowOffsetY = offset;\n        ctx.fillStyle = this.color;\n        ctx.fillText(this.text, drawX, drawY);\n      });\n\n      ctx.shadowColor = \"transparent\";\n      ctx.shadowBlur = 0;\n      ctx.shadowOffsetX = 0;\n      ctx.shadowOffsetY = 0;\n\n      ctx.fillStyle = this.color;\n      ctx.fillText(this.text, drawX, drawY);\n\n      ctx.restore();\n    } catch (error) {\n      logger.error(\"Comment.draw\", error as Error, {\n        text: this.text,\n        isActive: this.isActive,\n        hasContext: Boolean(ctx),\n        interpolatedX,\n      });\n    }\n  }\n}\n","import type { RendererSettings } from \"../shared/types\";\n\ntype ReadonlySettings = {\n  readonly [K in keyof RendererSettings]: RendererSettings[K] extends\n    | string\n    | number\n    | boolean\n    | null\n    | undefined\n    ? RendererSettings[K]\n    : ReadonlyArray<string>;\n};\n\nconst BASE_SETTINGS: RendererSettings = {\n  commentColor: \"#FFFFFF\",\n  commentOpacity: 0.75,\n  isCommentVisible: true,\n  useContainerResizeObserver: true,\n  ngWords: [],\n  ngRegexps: [],\n};\n\nexport const DEFAULT_RENDERER_SETTINGS: ReadonlySettings = BASE_SETTINGS;\n\nexport const cloneDefaultSettings = (): RendererSettings => ({\n  ...BASE_SETTINGS,\n  ngWords: [...BASE_SETTINGS.ngWords],\n  ngRegexps: [...BASE_SETTINGS.ngRegexps],\n});\n\nexport const RENDERER_VERSION = \"v1.0.0\";\n","import { cloneDefaultSettings } from \"../config/default-settings\";\nimport type { RendererSettings } from \"../shared/types\";\nimport {\n  Comment,\n  type CommentDependencies,\n  type CommentPrepareOptions,\n  type TimeSource,\n  createDefaultTimeSource,\n} from \"./comment\";\nimport { createLogger, type Logger } from \"../shared/logger\";\n\nexport interface CommentRendererConfig {\n  loggerNamespace?: string;\n  timeSource?: TimeSource;\n  animationFrameProvider?: AnimationFrameProvider;\n  createCanvasElement?: () => HTMLCanvasElement;\n}\n\nexport interface CommentRendererInitializeOptions {\n  video: HTMLVideoElement;\n  container?: HTMLElement | null;\n}\n\nexport interface AnimationFrameProvider {\n  request(callback: FrameRequestCallback): ReturnType<typeof setTimeout>;\n  cancel(handle: ReturnType<typeof setTimeout>): void;\n}\n\ninterface LaneReservation {\n  comment: Comment;\n  startTime: number;\n  endTime: number;\n  totalEndTime: number;\n  startLeft: number;\n  width: number;\n  speed: number;\n  buffer: number;\n}\n\nconst toMilliseconds = (seconds: number): number => seconds * 1000;\nconst FINAL_PHASE_THRESHOLD_MS = 10_000;\nconst ACTIVE_WINDOW_MS = 2_000;\nconst SEEK_WINDOW_MS = 4_000;\nconst VIRTUAL_CANVAS_EXTENSION_PX = 1_000;\nconst MAX_VISIBLE_DURATION_MS = 4_000;\nconst MIN_VISIBLE_DURATION_MS = 1_800;\nconst MAX_COMMENT_WIDTH_RATIO = 3;\nconst COLLISION_BUFFER_RATIO = 0.25;\nconst BASE_COLLISION_BUFFER_PX = 32;\nconst ENTRY_BUFFER_PX = 48;\nconst RESERVATION_TIME_MARGIN_MS = 120;\nconst MIN_LANE_COUNT = 1;\nconst DEFAULT_LANE_COUNT = 12;\nconst MIN_FONT_SIZE_PX = 24;\nconst EDGE_EPSILON = 1e-3;\n\nexport const createDefaultAnimationFrameProvider = (\n  timeSource: TimeSource,\n): AnimationFrameProvider => {\n  if (\n    typeof window !== \"undefined\" &&\n    typeof window.requestAnimationFrame === \"function\" &&\n    typeof window.cancelAnimationFrame === \"function\"\n  ) {\n    return {\n      request: (callback) => window.requestAnimationFrame(callback),\n      cancel: (handle) => window.cancelAnimationFrame(handle),\n    };\n  }\n  return {\n    request: (callback) => {\n      const timeoutId = globalThis.setTimeout(() => {\n        callback(timeSource.now());\n      }, 16);\n      return timeoutId;\n    },\n    cancel: (handle) => {\n      globalThis.clearTimeout(handle);\n    },\n  };\n};\n\nconst createBrowserCanvasFactory = (): (() => HTMLCanvasElement) => {\n  if (typeof document === \"undefined\") {\n    return () => {\n      throw new Error(\n        \"Document is not available. Provide a custom createCanvasElement implementation.\",\n      );\n    };\n  }\n  return () => document.createElement(\"canvas\");\n};\n\nconst isRendererSettings = (input: unknown): input is RendererSettings => {\n  if (!input || typeof input !== \"object\") {\n    return false;\n  }\n  const candidate = input as Record<string, unknown>;\n  return (\n    typeof candidate.commentColor === \"string\" &&\n    typeof candidate.commentOpacity === \"number\" &&\n    typeof candidate.isCommentVisible === \"boolean\"\n  );\n};\n\nexport class CommentRenderer {\n  private _settings: RendererSettings;\n  private readonly comments: Comment[] = [];\n  private readonly reservedLanes = new Map<number, LaneReservation[]>();\n  private readonly log: Logger;\n  private readonly timeSource: TimeSource;\n  private readonly animationFrameProvider: AnimationFrameProvider;\n  private readonly createCanvasElement: () => HTMLCanvasElement;\n  private readonly commentDependencies: CommentDependencies;\n  private canvas: HTMLCanvasElement | null = null;\n  private ctx: CanvasRenderingContext2D | null = null;\n  private videoElement: HTMLVideoElement | null = null;\n  private containerElement: HTMLElement | null = null;\n  private laneCount = DEFAULT_LANE_COUNT;\n  private laneHeight = 0;\n  private currentTime = 0;\n  private duration = 0;\n  private playbackRate = 1;\n  private isPlaying = true;\n  private lastDrawTime = 0;\n  private finalPhaseActive = false;\n  private frameId: ReturnType<typeof setTimeout> | null = null;\n  private resizeObserver: ResizeObserver | null = null;\n  private resizeObserverTarget: Element | null = null;\n  private readonly isResizeObserverAvailable = typeof ResizeObserver !== \"undefined\";\n  private readonly cleanupTasks: Array<() => void> = [];\n\n  constructor(settings: RendererSettings | null, config?: CommentRendererConfig);\n  constructor(config?: CommentRendererConfig);\n  constructor(\n    settingsOrConfig: RendererSettings | CommentRendererConfig | null = null,\n    maybeConfig: CommentRendererConfig | undefined = undefined,\n  ) {\n    let baseSettings: RendererSettings;\n    let config: CommentRendererConfig;\n\n    if (isRendererSettings(settingsOrConfig)) {\n      baseSettings = { ...settingsOrConfig };\n      config = maybeConfig ?? {};\n    } else {\n      const configCandidate = settingsOrConfig ?? maybeConfig ?? {};\n      config =\n        typeof configCandidate === \"object\" ? (configCandidate as CommentRendererConfig) : {};\n      baseSettings = cloneDefaultSettings();\n    }\n\n    this.timeSource = config.timeSource ?? createDefaultTimeSource();\n    this.animationFrameProvider =\n      config.animationFrameProvider ?? createDefaultAnimationFrameProvider(this.timeSource);\n    this.createCanvasElement = config.createCanvasElement ?? createBrowserCanvasFactory();\n    this.commentDependencies = { timeSource: this.timeSource };\n    this._settings = { ...baseSettings };\n    this.log = createLogger(config.loggerNamespace ?? \"CommentRenderer\");\n  }\n\n  get settings(): RendererSettings {\n    return this._settings;\n  }\n\n  set settings(value: RendererSettings) {\n    this._settings = { ...value };\n  }\n\n  private resolveContainer(\n    explicit: HTMLElement | null | undefined,\n    video: HTMLVideoElement,\n  ): HTMLElement {\n    if (explicit) {\n      return explicit;\n    }\n    if (video.parentElement) {\n      return video.parentElement;\n    }\n    if (typeof document !== \"undefined\" && document.body) {\n      return document.body;\n    }\n    throw new Error(\n      \"Cannot resolve container element. Provide container explicitly when DOM is unavailable.\",\n    );\n  }\n\n  private ensureContainerPositioning(container: HTMLElement): void {\n    if (typeof getComputedStyle === \"function\") {\n      const style = getComputedStyle(container);\n      if (style.position === \"static\") {\n        container.style.position = \"relative\";\n      }\n      return;\n    }\n    if (!container.style.position) {\n      container.style.position = \"relative\";\n    }\n  }\n\n  initialize(options: HTMLVideoElement | CommentRendererInitializeOptions): void {\n    try {\n      this.destroyCanvasOnly();\n\n      const video = options instanceof HTMLVideoElement ? options : options.video;\n      const containerCandidate =\n        options instanceof HTMLVideoElement\n          ? options.parentElement\n          : (options.container ?? options.video.parentElement);\n      const container = this.resolveContainer(containerCandidate ?? null, video);\n\n      this.videoElement = video;\n      this.containerElement = container;\n      this.duration = Number.isFinite(video.duration) ? toMilliseconds(video.duration) : 0;\n      this.currentTime = toMilliseconds(video.currentTime);\n      this.playbackRate = video.playbackRate;\n      this.isPlaying = !video.paused;\n      this.lastDrawTime = this.timeSource.now();\n\n      const canvas = this.createCanvasElement();\n      const context = canvas.getContext(\"2d\");\n      if (!context) {\n        throw new Error(\"Failed to acquire 2D canvas context\");\n      }\n\n      canvas.style.position = \"absolute\";\n      canvas.style.top = \"0\";\n      canvas.style.left = \"0\";\n      canvas.style.pointerEvents = \"none\";\n      canvas.style.zIndex = \"1000\";\n\n      const parent = this.containerElement;\n      if (parent instanceof HTMLElement) {\n        this.ensureContainerPositioning(parent);\n        parent.appendChild(canvas);\n      }\n\n      this.canvas = canvas;\n      this.ctx = context;\n\n      this.resize();\n      this.calculateLaneMetrics();\n      this.setupVideoEventListeners(video);\n      this.setupResizeHandling(video);\n      this.setupVideoChangeDetection(video, container);\n      this.startAnimation();\n    } catch (error) {\n      this.log.error(\"CommentRenderer.initialize\", error as Error);\n      throw error;\n    }\n  }\n\n  addComment(text: string, vpos: number, commands: string[] = []): Comment | null {\n    if (this.isNGComment(text)) {\n      return null;\n    }\n    const duplicate = this.comments.some(\n      (comment) => comment.text === text && comment.vpos === vpos,\n    );\n    if (duplicate) {\n      return null;\n    }\n\n    const comment = new Comment(text, vpos, commands, this._settings, this.commentDependencies);\n    this.comments.push(comment);\n    this.comments.sort((a, b) => a.vpos - b.vpos);\n    return comment;\n  }\n\n  clearComments(): void {\n    this.comments.length = 0;\n    this.reservedLanes.clear();\n    if (this.ctx && this.canvas) {\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n  }\n\n  resetState(): void {\n    this.clearComments();\n    this.currentTime = 0;\n    this.finalPhaseActive = false;\n  }\n\n  destroy(): void {\n    this.stopAnimation();\n    this.cleanupResizeHandling();\n    this.runCleanupTasks();\n\n    if (this.canvas) {\n      this.canvas.remove();\n    }\n    this.canvas = null;\n    this.ctx = null;\n    this.videoElement = null;\n    this.containerElement = null;\n    this.comments.length = 0;\n    this.reservedLanes.clear();\n    this.finalPhaseActive = false;\n  }\n\n  updateSettings(newSettings: RendererSettings): void {\n    const previousUseContainer = this._settings.useContainerResizeObserver;\n    this.settings = newSettings;\n\n    this.comments.forEach((comment) => {\n      comment.color = this._settings.commentColor;\n      comment.opacity = this._settings.commentOpacity;\n    });\n\n    if (!this._settings.isCommentVisible && this.ctx && this.canvas) {\n      this.comments.forEach((comment) => {\n        comment.isActive = false;\n      });\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    if (previousUseContainer !== this._settings.useContainerResizeObserver && this.videoElement) {\n      this.setupResizeHandling(this.videoElement);\n    }\n  }\n\n  getVideoElement(): HTMLVideoElement | null {\n    return this.videoElement;\n  }\n\n  getCurrentVideoSource(): string | null {\n    const video = this.videoElement;\n    if (!video) {\n      return null;\n    }\n    if (typeof video.currentSrc === \"string\" && video.currentSrc.length > 0) {\n      return video.currentSrc;\n    }\n    const attribute = video.getAttribute(\"src\");\n    if (attribute && attribute.length > 0) {\n      return attribute;\n    }\n    const sourceElement = video.querySelector(\"source[src]\") as HTMLSourceElement | null;\n    if (sourceElement && typeof sourceElement.src === \"string\") {\n      return sourceElement.src;\n    }\n    return null;\n  }\n\n  getCommentsSnapshot(): Comment[] {\n    return [...this.comments];\n  }\n\n  isNGComment(text: string): boolean {\n    try {\n      if (typeof text !== \"string\") {\n        return true;\n      }\n\n      if (Array.isArray(this._settings.ngWords)) {\n        const containsNgWord = this._settings.ngWords.some(\n          (word) => typeof word === \"string\" && word.length > 0 && text.includes(word),\n        );\n        if (containsNgWord) {\n          return true;\n        }\n      }\n\n      if (Array.isArray(this._settings.ngRegexps)) {\n        return this._settings.ngRegexps.some((pattern) => {\n          if (typeof pattern !== \"string\" || pattern.length === 0) {\n            return false;\n          }\n          try {\n            return new RegExp(pattern).test(text);\n          } catch (regexError) {\n            this.log.error(\"CommentRenderer.isNGComment.regex\", regexError as Error, {\n              pattern,\n              text,\n            });\n            return false;\n          }\n        });\n      }\n\n      return false;\n    } catch (error) {\n      this.log.error(\"CommentRenderer.isNGComment\", error as Error, { text });\n      return true;\n    }\n  }\n\n  resize(width?: number, height?: number): void {\n    const video = this.videoElement;\n    const canvas = this.canvas;\n    if (!video || !canvas) {\n      return;\n    }\n\n    const rect = video.getBoundingClientRect();\n    const measuredWidth = width ?? rect.width ?? canvas.width;\n    const measuredHeight = height ?? rect.height ?? canvas.height;\n\n    if (\n      !Number.isFinite(measuredWidth) ||\n      !Number.isFinite(measuredHeight) ||\n      measuredWidth <= 0 ||\n      measuredHeight <= 0\n    ) {\n      return;\n    }\n\n    const nextWidth = Math.max(1, Math.floor(measuredWidth));\n    const nextHeight = Math.max(1, Math.floor(measuredHeight));\n\n    if (!Number.isFinite(nextWidth) || !Number.isFinite(nextHeight)) {\n      return;\n    }\n\n    const previousWidth = canvas.width || nextWidth;\n    const previousHeight = canvas.height || nextHeight;\n\n    if (previousWidth === nextWidth && previousHeight === nextHeight) {\n      return;\n    }\n\n    canvas.width = nextWidth;\n    canvas.height = nextHeight;\n    canvas.style.width = `${nextWidth}px`;\n    canvas.style.height = `${nextHeight}px`;\n\n    const scaleX = previousWidth > 0 ? nextWidth / previousWidth : 1;\n    const scaleY = previousHeight > 0 ? nextHeight / previousHeight : 1;\n\n    if (scaleX !== 1 || scaleY !== 1) {\n      this.comments.forEach((comment) => {\n        if (comment.isActive) {\n          comment.x *= scaleX;\n          comment.y *= scaleY;\n          comment.baseSpeed *= scaleX;\n          comment.speed *= scaleX;\n          comment.fontSize = Math.max(MIN_FONT_SIZE_PX, Math.floor(nextHeight * 0.05));\n        }\n      });\n    }\n\n    this.calculateLaneMetrics();\n  }\n\n  private destroyCanvasOnly(): void {\n    this.stopAnimation();\n    this.cleanupResizeHandling();\n    this.runCleanupTasks();\n    if (this.canvas) {\n      this.canvas.remove();\n    }\n    this.canvas = null;\n    this.ctx = null;\n  }\n\n  private calculateLaneMetrics(): void {\n    const canvas = this.canvas;\n    if (!canvas) {\n      return;\n    }\n\n    const baseHeight = Math.max(MIN_FONT_SIZE_PX, Math.floor(canvas.height * 0.05));\n    this.laneHeight = baseHeight * 1.2;\n    const availableLanes = Math.floor(canvas.height / Math.max(this.laneHeight, 1));\n    this.laneCount = Math.max(MIN_LANE_COUNT, availableLanes);\n  }\n\n  private updateComments(): void {\n    const video = this.videoElement;\n    const canvas = this.canvas;\n    const context = this.ctx;\n    if (!video || !canvas || !context) {\n      return;\n    }\n\n    this.currentTime = toMilliseconds(video.currentTime);\n    this.playbackRate = video.playbackRate;\n    this.isPlaying = !video.paused;\n    const prepareOptions = this.buildPrepareOptions(canvas.width);\n\n    const isNearEnd =\n      this.duration > 0 && this.duration - this.currentTime <= FINAL_PHASE_THRESHOLD_MS;\n\n    if (isNearEnd && !this.finalPhaseActive) {\n      this.finalPhaseActive = true;\n      context.clearRect(0, 0, canvas.width, canvas.height);\n      this.comments.forEach((comment) => {\n        comment.isActive = false;\n      });\n      this.reservedLanes.clear();\n    }\n\n    if (!isNearEnd && this.finalPhaseActive) {\n      this.finalPhaseActive = false;\n    }\n\n    for (const comment of this.comments) {\n      if (this.isNGComment(comment.text)) {\n        continue;\n      }\n\n      comment.color = this._settings.commentColor;\n      comment.opacity = this._settings.commentOpacity;\n\n      if (!comment.isActive) {\n        const shouldShow = isNearEnd\n          ? comment.vpos > this.currentTime - FINAL_PHASE_THRESHOLD_MS && !comment.hasShown\n          : comment.vpos >= this.currentTime - ACTIVE_WINDOW_MS &&\n            comment.vpos <= this.currentTime + ACTIVE_WINDOW_MS;\n\n        if (shouldShow) {\n          comment.prepare(context, canvas.width, canvas.height, prepareOptions);\n          comment.lane = this.findAvailableLane(comment);\n          comment.y = comment.lane * this.laneHeight;\n          comment.x = comment.virtualStartX;\n          comment.isActive = true;\n          comment.hasShown = true;\n        }\n      }\n\n      if (comment.isActive) {\n        comment.update(this.playbackRate, !this.isPlaying);\n      }\n    }\n\n    for (const comment of this.comments) {\n      if (comment.isActive && comment.x < -comment.width) {\n        comment.isActive = false;\n      }\n    }\n  }\n\n  private buildPrepareOptions(visibleWidth: number): CommentPrepareOptions {\n    return {\n      visibleWidth,\n      virtualExtension: VIRTUAL_CANVAS_EXTENSION_PX,\n      maxVisibleDurationMs: MAX_VISIBLE_DURATION_MS,\n      minVisibleDurationMs: MIN_VISIBLE_DURATION_MS,\n      maxWidthRatio: MAX_COMMENT_WIDTH_RATIO,\n      bufferRatio: COLLISION_BUFFER_RATIO,\n      baseBufferPx: BASE_COLLISION_BUFFER_PX,\n      entryBufferPx: ENTRY_BUFFER_PX,\n    };\n  }\n\n  private findAvailableLane(comment: Comment): number {\n    const currentTime = this.currentTime;\n    this.pruneLaneReservations(currentTime);\n    const laneCandidates = this.getLanePriorityOrder(currentTime);\n    const newReservation = this.createLaneReservation(comment, currentTime);\n\n    for (const lane of laneCandidates) {\n      if (this.isLaneAvailable(lane, newReservation, currentTime)) {\n        this.storeLaneReservation(lane, newReservation);\n        return lane;\n      }\n    }\n\n    const fallbackLane = laneCandidates[0] ?? 0;\n    this.storeLaneReservation(fallbackLane, newReservation);\n    return fallbackLane;\n  }\n\n  private pruneLaneReservations(currentTime: number): void {\n    for (const [lane, reservations] of this.reservedLanes.entries()) {\n      const filtered = reservations.filter(\n        (reservation) => reservation.totalEndTime + RESERVATION_TIME_MARGIN_MS > currentTime,\n      );\n      if (filtered.length > 0) {\n        this.reservedLanes.set(lane, filtered);\n      } else {\n        this.reservedLanes.delete(lane);\n      }\n    }\n  }\n\n  private getLanePriorityOrder(currentTime: number): number[] {\n    const indices = Array.from({ length: this.laneCount }, (_, index) => index);\n    return indices.sort((a, b) => {\n      const nextA = this.getLaneNextAvailableTime(a, currentTime);\n      const nextB = this.getLaneNextAvailableTime(b, currentTime);\n      if (Math.abs(nextA - nextB) <= EDGE_EPSILON) {\n        return a - b;\n      }\n      return nextA - nextB;\n    });\n  }\n\n  private getLaneNextAvailableTime(lane: number, currentTime: number): number {\n    const reservations = this.reservedLanes.get(lane);\n    if (!reservations || reservations.length === 0) {\n      return currentTime;\n    }\n    let nextTime = currentTime;\n    for (const reservation of reservations) {\n      nextTime = Math.max(nextTime, reservation.endTime);\n    }\n    return nextTime;\n  }\n\n  private createLaneReservation(comment: Comment, startTime: number): LaneReservation {\n    const speed = Math.max(comment.speedPixelsPerMs, EDGE_EPSILON);\n    const endTime = startTime + comment.preCollisionDurationMs + RESERVATION_TIME_MARGIN_MS;\n    const totalEndTime = startTime + comment.totalDurationMs + RESERVATION_TIME_MARGIN_MS;\n    return {\n      comment,\n      startTime,\n      endTime: Math.max(startTime, endTime),\n      totalEndTime: Math.max(startTime, totalEndTime),\n      startLeft: comment.virtualStartX,\n      width: comment.width,\n      speed,\n      buffer: comment.bufferWidth,\n    };\n  }\n\n  private isLaneAvailable(lane: number, candidate: LaneReservation, currentTime: number): boolean {\n    const reservations = this.reservedLanes.get(lane);\n    if (!reservations || reservations.length === 0) {\n      return true;\n    }\n    for (const reservation of reservations) {\n      if (reservation.totalEndTime + RESERVATION_TIME_MARGIN_MS <= currentTime) {\n        continue;\n      }\n      if (this.areReservationsConflicting(reservation, candidate)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private storeLaneReservation(lane: number, reservation: LaneReservation): void {\n    const existing = this.reservedLanes.get(lane) ?? [];\n    const updated = [...existing, reservation].sort((a, b) => a.endTime - b.endTime);\n    this.reservedLanes.set(lane, updated);\n  }\n\n  private areReservationsConflicting(a: LaneReservation, b: LaneReservation): boolean {\n    const overlapStart = Math.max(a.startTime, b.startTime);\n    const overlapEnd = Math.min(a.endTime, b.endTime);\n    if (overlapStart >= overlapEnd) {\n      return false;\n    }\n\n    const evaluationTimes = new Set<number>([\n      overlapStart,\n      overlapEnd,\n      overlapStart + (overlapEnd - overlapStart) / 2,\n    ]);\n\n    const forwardIntersection = this.solveLeftRightEqualityTime(a, b);\n    if (\n      forwardIntersection !== null &&\n      forwardIntersection >= overlapStart - EDGE_EPSILON &&\n      forwardIntersection <= overlapEnd + EDGE_EPSILON\n    ) {\n      evaluationTimes.add(forwardIntersection);\n    }\n\n    const backwardIntersection = this.solveLeftRightEqualityTime(b, a);\n    if (\n      backwardIntersection !== null &&\n      backwardIntersection >= overlapStart - EDGE_EPSILON &&\n      backwardIntersection <= overlapEnd + EDGE_EPSILON\n    ) {\n      evaluationTimes.add(backwardIntersection);\n    }\n\n    for (const time of evaluationTimes) {\n      if (time < overlapStart - EDGE_EPSILON || time > overlapEnd + EDGE_EPSILON) {\n        continue;\n      }\n      const forwardGap = this.computeForwardGap(a, b, time);\n      const backwardGap = this.computeForwardGap(b, a, time);\n      if (forwardGap <= EDGE_EPSILON && backwardGap <= EDGE_EPSILON) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  private computeForwardGap(from: LaneReservation, to: LaneReservation, time: number): number {\n    const fromEdges = this.getBufferedEdges(from, time);\n    const toEdges = this.getBufferedEdges(to, time);\n    return fromEdges.left - toEdges.right;\n  }\n\n  private getBufferedEdges(\n    reservation: LaneReservation,\n    time: number,\n  ): { left: number; right: number } {\n    const elapsed = Math.max(0, time - reservation.startTime);\n    const displacement = reservation.speed * elapsed;\n    const rawLeft = reservation.startLeft - displacement;\n    const left = rawLeft - reservation.buffer;\n    const right = rawLeft + reservation.width + reservation.buffer;\n    return { left, right };\n  }\n\n  private solveLeftRightEqualityTime(left: LaneReservation, right: LaneReservation): number | null {\n    const denominator = right.speed - left.speed;\n    if (Math.abs(denominator) < EDGE_EPSILON) {\n      return null;\n    }\n    const numerator =\n      right.startLeft +\n      right.speed * right.startTime +\n      right.width +\n      right.buffer -\n      left.startLeft -\n      left.speed * left.startTime +\n      left.buffer;\n    const time = numerator / denominator;\n    if (!Number.isFinite(time)) {\n      return null;\n    }\n    return time;\n  }\n\n  private draw(): void {\n    const canvas = this.canvas;\n    const context = this.ctx;\n    if (!canvas || !context) {\n      return;\n    }\n\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    const activeComments = this.comments.filter((comment) => comment.isActive);\n    const now = this.timeSource.now();\n\n    if (this._settings.isCommentVisible) {\n      const deltaTime = (now - this.lastDrawTime) / (1000 / 60);\n      activeComments.forEach((comment) => {\n        const interpolatedX = comment.x - comment.speed * deltaTime;\n        comment.draw(context, interpolatedX);\n      });\n    }\n\n    this.lastDrawTime = now;\n  }\n\n  private readonly updateFrame = (): void => {\n    if (!this.videoElement) {\n      return;\n    }\n    if (!this._settings.isCommentVisible) {\n      this.frameId = this.animationFrameProvider.request(this.updateFrame);\n      return;\n    }\n    this.updateComments();\n    this.draw();\n    this.frameId = this.animationFrameProvider.request(this.updateFrame);\n  };\n\n  private startAnimation(): void {\n    this.stopAnimation();\n    this.frameId = this.animationFrameProvider.request(this.updateFrame);\n  }\n\n  private stopAnimation(): void {\n    if (this.frameId !== null) {\n      this.animationFrameProvider.cancel(this.frameId);\n      this.frameId = null;\n    }\n  }\n\n  private onSeek(): void {\n    const canvas = this.canvas;\n    const context = this.ctx;\n    const video = this.videoElement;\n    if (!canvas || !context || !video) {\n      return;\n    }\n\n    this.finalPhaseActive = false;\n    this.currentTime = toMilliseconds(video.currentTime);\n\n    this.reservedLanes.clear();\n    const prepareOptions = this.buildPrepareOptions(canvas.width);\n\n    this.comments.forEach((comment) => {\n      if (\n        comment.vpos >= this.currentTime - SEEK_WINDOW_MS &&\n        comment.vpos <= this.currentTime + SEEK_WINDOW_MS\n      ) {\n        comment.prepare(context, canvas.width, canvas.height, prepareOptions);\n        comment.lane = this.findAvailableLane(comment);\n        comment.y = comment.lane * this.laneHeight;\n        const timeDiff = (this.currentTime - comment.vpos) / 1000;\n        const distance = comment.speed * timeDiff * 60;\n        comment.x = comment.virtualStartX - distance;\n        comment.isActive = comment.x > -comment.width;\n        if (comment.x < -comment.width) {\n          comment.isActive = false;\n          comment.hasShown = true;\n        }\n      } else {\n        comment.isActive = false;\n      }\n    });\n  }\n\n  private setupVideoEventListeners(videoElement: HTMLVideoElement): void {\n    try {\n      const onPlay = (): void => {\n        this.isPlaying = true;\n        const now = this.timeSource.now();\n        this.lastDrawTime = now;\n        this.comments.forEach((comment) => {\n          comment.lastUpdateTime = now;\n          comment.isPaused = false;\n        });\n      };\n      const onPause = (): void => {\n        this.isPlaying = false;\n        const now = this.timeSource.now();\n        this.comments.forEach((comment) => {\n          comment.lastUpdateTime = now;\n          comment.isPaused = true;\n        });\n      };\n      const onSeeking = (): void => {\n        this.onSeek();\n      };\n      const onSeeked = (): void => {\n        this.onSeek();\n      };\n      const onRateChange = (): void => {\n        this.playbackRate = videoElement.playbackRate;\n        const now = this.timeSource.now();\n        this.comments.forEach((comment) => {\n          comment.lastUpdateTime = now;\n        });\n      };\n      const onLoadedMetadata = (): void => {\n        this.handleVideoMetadataLoaded(videoElement);\n      };\n      const onDurationChange = (): void => {\n        this.duration = Number.isFinite(videoElement.duration)\n          ? toMilliseconds(videoElement.duration)\n          : 0;\n      };\n      const onEmptied = (): void => {\n        this.handleVideoSourceChange();\n      };\n\n      videoElement.addEventListener(\"play\", onPlay);\n      videoElement.addEventListener(\"pause\", onPause);\n      videoElement.addEventListener(\"seeking\", onSeeking);\n      videoElement.addEventListener(\"seeked\", onSeeked);\n      videoElement.addEventListener(\"ratechange\", onRateChange);\n      videoElement.addEventListener(\"loadedmetadata\", onLoadedMetadata);\n      videoElement.addEventListener(\"durationchange\", onDurationChange);\n      videoElement.addEventListener(\"emptied\", onEmptied);\n\n      this.addCleanup(() => videoElement.removeEventListener(\"play\", onPlay));\n      this.addCleanup(() => videoElement.removeEventListener(\"pause\", onPause));\n      this.addCleanup(() => videoElement.removeEventListener(\"seeking\", onSeeking));\n      this.addCleanup(() => videoElement.removeEventListener(\"seeked\", onSeeked));\n      this.addCleanup(() => videoElement.removeEventListener(\"ratechange\", onRateChange));\n      this.addCleanup(() => videoElement.removeEventListener(\"loadedmetadata\", onLoadedMetadata));\n      this.addCleanup(() => videoElement.removeEventListener(\"durationchange\", onDurationChange));\n      this.addCleanup(() => videoElement.removeEventListener(\"emptied\", onEmptied));\n    } catch (error) {\n      this.log.error(\"CommentRenderer.setupVideoEventListeners\", error as Error);\n      throw error;\n    }\n  }\n\n  private handleVideoMetadataLoaded(videoElement: HTMLVideoElement): void {\n    this.handleVideoSourceChange(videoElement);\n    this.resize();\n    this.calculateLaneMetrics();\n    this.onSeek();\n  }\n\n  private handleVideoSourceChange(videoElement?: HTMLVideoElement | null): void {\n    const target = videoElement ?? this.videoElement;\n    if (!target) {\n      this.isPlaying = false;\n      this.finalPhaseActive = false;\n      this.resetCommentActivity();\n      return;\n    }\n    this.syncVideoState(target);\n    this.finalPhaseActive = false;\n    this.resetCommentActivity();\n  }\n\n  private syncVideoState(videoElement: HTMLVideoElement): void {\n    this.duration = Number.isFinite(videoElement.duration)\n      ? toMilliseconds(videoElement.duration)\n      : 0;\n    this.currentTime = toMilliseconds(videoElement.currentTime);\n    this.playbackRate = videoElement.playbackRate;\n    this.isPlaying = !videoElement.paused;\n    this.lastDrawTime = this.timeSource.now();\n  }\n\n  private resetCommentActivity(): void {\n    const now = this.timeSource.now();\n    const canvas = this.canvas;\n    const context = this.ctx;\n    if (canvas && context) {\n      context.clearRect(0, 0, canvas.width, canvas.height);\n    }\n    this.reservedLanes.clear();\n    this.comments.forEach((comment) => {\n      comment.isActive = false;\n      comment.isPaused = !this.isPlaying;\n      comment.hasShown = false;\n      comment.lane = -1;\n      comment.x = comment.virtualStartX;\n      comment.speed = comment.baseSpeed;\n      comment.lastUpdateTime = now;\n    });\n  }\n\n  private setupVideoChangeDetection(videoElement: HTMLVideoElement, container: HTMLElement): void {\n    if (typeof MutationObserver === \"undefined\") {\n      this.log.debug(\n        \"MutationObserver is not available in this environment. Video change detection is disabled.\",\n      );\n      return;\n    }\n\n    const videoObserver = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        if (mutation.type === \"attributes\" && mutation.attributeName === \"src\") {\n          const targetNode = mutation.target;\n          let previous: string | null = null;\n          let current: string | null = null;\n          if (targetNode instanceof HTMLVideoElement || targetNode instanceof HTMLSourceElement) {\n            previous = typeof mutation.oldValue === \"string\" ? mutation.oldValue : null;\n            current = targetNode.getAttribute(\"src\");\n          }\n          if (previous === current) {\n            continue;\n          }\n          this.handleVideoSourceChange(videoElement);\n          return;\n        }\n        if (mutation.type === \"childList\") {\n          for (const node of mutation.addedNodes) {\n            if (node instanceof HTMLSourceElement) {\n              this.handleVideoSourceChange(videoElement);\n              return;\n            }\n          }\n          for (const node of mutation.removedNodes) {\n            if (node instanceof HTMLSourceElement) {\n              this.handleVideoSourceChange(videoElement);\n              return;\n            }\n          }\n        }\n      }\n    });\n\n    videoObserver.observe(videoElement, {\n      attributes: true,\n      attributeFilter: [\"src\"],\n      attributeOldValue: true,\n      childList: true,\n      subtree: true,\n    });\n    this.addCleanup(() => videoObserver.disconnect());\n\n    const containerObserver = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        if (mutation.type !== \"childList\") {\n          continue;\n        }\n        for (const node of mutation.addedNodes) {\n          const nextVideo = this.extractVideoElement(node);\n          if (nextVideo && nextVideo !== this.videoElement) {\n            this.initialize(nextVideo);\n            return;\n          }\n        }\n        for (const node of mutation.removedNodes) {\n          if (node === this.videoElement) {\n            this.videoElement = null;\n            this.handleVideoSourceChange(null);\n            return;\n          }\n          if (node instanceof Element) {\n            const removedVideo = node.querySelector(\"video\");\n            if (removedVideo && removedVideo === this.videoElement) {\n              this.videoElement = null;\n              this.handleVideoSourceChange(null);\n              return;\n            }\n          }\n        }\n      }\n    });\n\n    containerObserver.observe(container, { childList: true, subtree: true });\n    this.addCleanup(() => containerObserver.disconnect());\n  }\n\n  private extractVideoElement(node: Node): HTMLVideoElement | null {\n    if (node instanceof HTMLVideoElement) {\n      return node;\n    }\n    if (node instanceof Element) {\n      const candidate = node.querySelector(\"video\");\n      if (candidate instanceof HTMLVideoElement) {\n        return candidate;\n      }\n    }\n    return null;\n  }\n\n  private setupResizeHandling(videoElement: HTMLVideoElement): void {\n    this.cleanupResizeHandling();\n\n    if (this._settings.useContainerResizeObserver && this.isResizeObserverAvailable) {\n      const target = videoElement.parentElement ?? videoElement;\n      const observer = new ResizeObserver((entries) => {\n        for (const entry of entries) {\n          const { width, height } = entry.contentRect;\n          if (width > 0 && height > 0) {\n            this.resize(width, height);\n          } else {\n            this.resize();\n          }\n        }\n      });\n      observer.observe(target);\n      this.resizeObserver = observer;\n      this.resizeObserverTarget = target;\n    } else if (typeof window !== \"undefined\" && typeof window.addEventListener === \"function\") {\n      const onResize = (): void => {\n        this.resize();\n      };\n      window.addEventListener(\"resize\", onResize);\n      this.addCleanup(() => window.removeEventListener(\"resize\", onResize));\n    } else {\n      this.log.debug(\n        \"Resize handling is disabled because neither ResizeObserver nor window APIs are available.\",\n      );\n    }\n  }\n\n  private cleanupResizeHandling(): void {\n    if (this.resizeObserver && this.resizeObserverTarget) {\n      this.resizeObserver.unobserve(this.resizeObserverTarget);\n    }\n    this.resizeObserver?.disconnect();\n    this.resizeObserver = null;\n    this.resizeObserverTarget = null;\n  }\n\n  private addCleanup(task: () => void): void {\n    this.cleanupTasks.push(task);\n  }\n\n  private runCleanupTasks(): void {\n    while (this.cleanupTasks.length > 0) {\n      const task = this.cleanupTasks.pop();\n      try {\n        task?.();\n      } catch (error) {\n        this.log.error(\"CommentRenderer.cleanupTask\", error as Error);\n      }\n    }\n  }\n}\n"],"names":["LEVEL_PRIORITY","fallbackEmitter","level","namespace","args","consoleArgs","createLogger","options","emitter","threshold","emit","logLevel","messages","logger","createPerformanceTimeSource","createDefaultTimeSource","Comment","text","vpos","commands","settings","dependencies","ctx","visibleWidth","canvasHeight","safeVisibleWidth","maxReservationWidth","bufferFromWidth","entryBuffer","widthRatio","visibleDurationMs","clampedRatio","adjustedDuration","visibleDistance","safeVisibleDuration","pixelsPerMs","pixelsPerFrame","travelDistance","preCollisionBoundary","startRight","safePixelsPerMs","preCollisionDistance","reservationBase","error","playbackRate","isPaused","currentTime","deltaTime","interpolatedX","drawX","drawY","baseShadowOffset","baseShadowBlur","layer","offset","BASE_SETTINGS","DEFAULT_RENDERER_SETTINGS","cloneDefaultSettings","RENDERER_VERSION","toMilliseconds","seconds","FINAL_PHASE_THRESHOLD_MS","ACTIVE_WINDOW_MS","SEEK_WINDOW_MS","VIRTUAL_CANVAS_EXTENSION_PX","MAX_VISIBLE_DURATION_MS","MIN_VISIBLE_DURATION_MS","MAX_COMMENT_WIDTH_RATIO","COLLISION_BUFFER_RATIO","BASE_COLLISION_BUFFER_PX","ENTRY_BUFFER_PX","RESERVATION_TIME_MARGIN_MS","MIN_LANE_COUNT","DEFAULT_LANE_COUNT","MIN_FONT_SIZE_PX","EDGE_EPSILON","createDefaultAnimationFrameProvider","timeSource","callback","handle","createBrowserCanvasFactory","isRendererSettings","input","candidate","CommentRenderer","settingsOrConfig","maybeConfig","baseSettings","config","configCandidate","value","explicit","video","container","containerCandidate","canvas","context","parent","comment","a","b","newSettings","previousUseContainer","attribute","sourceElement","word","pattern","regexError","width","height","rect","measuredWidth","measuredHeight","nextWidth","nextHeight","previousWidth","previousHeight","scaleX","scaleY","baseHeight","availableLanes","prepareOptions","isNearEnd","laneCandidates","newReservation","lane","fallbackLane","reservations","filtered","reservation","_","index","nextA","nextB","nextTime","startTime","speed","endTime","totalEndTime","updated","overlapStart","overlapEnd","evaluationTimes","forwardIntersection","backwardIntersection","time","forwardGap","backwardGap","from","to","fromEdges","toEdges","elapsed","displacement","rawLeft","left","right","denominator","activeComments","now","timeDiff","distance","videoElement","onPlay","onPause","onSeeking","onSeeked","onRateChange","onLoadedMetadata","onDurationChange","onEmptied","target","videoObserver","mutations","mutation","targetNode","previous","current","node","containerObserver","nextVideo","removedVideo","observer","entries","entry","onResize","task"],"mappings":"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"}